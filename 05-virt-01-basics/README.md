# Домашнее задание к занятию "5.1. Основы виртуализации"

## Модуль 5. Виртуализация

### Студент: Иван Жиляев

## Обязательные задания

## Задача 1 

>Выберите тип использования виртуальных машин  / докер-контейнера или физического сервера / ПК для конкретного сценария. Мотивируйте свой выбор.
>
>Cценарии:
>
>- Высоконагруженный централизованный кластер Oracle, содержащий базы данных для всей организации

Для данного сценария ключевыми требованиями к "железу" скорее всего будут отказоустойчивость и скорость работы. Считаю оптимальным использование нескольких физических серверов, что позволит иметь несколько точек отказа, а также параллельную обработку запросов. В некоторых случаях критически важно иметь наименьшую задержку при работе приложения с ОЗУ, что исключает применение виртуализации. Но в ряде случаев, если количество БД велико, а скорость работы с ОЗУ не критична, то может быть удобным дополнительное разделение нод кластера по виртуальным машинам.

>- Сервер для нагрузочного тестирования

Мне кажется, что выбор платформы будет сильно зависеть от того, в каких условиях будет работать "боевое" приложение. Ведь для наиболее объективных результатов тестирования стоит подобрать наиболее близкую конфигурацию среды.

>- Билд агент Jenkins

Учитывая, что агент должен быть ярким представителем концепции "стада", то физическую машину брать точно не будем. А если учесть, что в ходе сборки агенту может потребоваться использовать контейнеризацию (например, для multi-stage-building), то оптимальным решением вижу ВМ под контролем какой-либо системы автоконфигурирования (Vagrant).

>- Продуктивный сервер системы риск мониторинга карточного процессинга с высокими требованиями к ОЗУ и ресурсам процессора 

Для снижения накладных расходов при работе приложения с ОЗУ и ЦП нам придётся избежать виртуализации, т.к. она, как дополнительный слой абстракции между "софтом" и "железом" вносит задержки. Так что остаётся использовать физический сервер.

>- Продуктивная база Postgre SQL

Контейнеры использовать не стоит, т.к. они оптимизированы для продуктов с хорошим горизонтальным масштабированием (за счёт увеличения числа нод), к которым нельзя отнести БД Postgre SQL. Нужно делать выбор между виртуальной машиной и физическим сервером исходя из конкретных условий. Думаю, подойдёт стратегия "если нет противопоказаний - ставить на ВМ".

>- Дев сервер для tomcat java web приложения

Так как для этого сценария требуется конкретное и небольшое количество серверных приложений, а разработку приложения стоит изолировать от других процессов, то оптимальный выбор - использовать контейнер. Также это решение поможет сразу развернуть готовую среду для запуска приложения из готового образа, например, с Dockerhub.

>- Продуктивная система управления артефатами Nexus / Artifactory, задейтсвованная в процессе CI/CD

Так как такие системы подразумевают использование БД, то для прода контейнеры я не стал бы исползовать. А физический сервер будет затратно масштабировать при увеличении количества обращений. Так что, пожалуй, ВМ будет лучшим выбором.

>- Веб сервер для статического веб сайта - html / css 

Данный вид нагрузки хорошо поддаётся горизонтальному масштабированию, так что лучше использовать контейнер.

## Задача 2 

>Детально опишите сценарий миграции инфраструктуры с физических серверов на виртуальные машины 
>
>Необходимо описать два сценария - миграция на виртуальные машины в Hyper-v или VMWare и второй сценарий - миграция на AWS ЕС2 / Azure virtual machines. Можно использовать графические и тестовые представления для описания, а также комбинированный подход. 
>
>Описание инфраструктуры:
>
>Продуктивные сервера для легаси системы:
>
>- Четыре cервера приложений (2 основных, 2 колд реплики ) для программного продукта на базе устаревшей версии java
>- Два сервера для создания и хранения резервных копий
>- Два сервера баз данных Sybase - основной и реплика
>

- при миграции на ВМ разумно использовать два или более физических сервера: это обеспечит защиту от аварий с "железом". Если брать самый скромный вариант, то на каждом сервере окажутся по одному экземпяру ВМ с основным сервером ПО, колд-репликой, нода БД, нода делающая бэкапы.  
Сначала стоит оценть необходимые ресурсы и требования для выбора количества реальных физических серверов в новой конфигурации инфраструктуры: сколько ядер и памяти нужно под экземпляр сервера ПО, какой объём будет у БД, что и как часто будем бэкапить и с какой глубиной.  
После подготовки нового железа, можно относительно спокойно перевести на него половину рабочих сервисов. А когда всё будет готово, то за счёт наличия избыточности у каждого из сервисов, можно будет без простоя снова относително спокойно перевести вторую половину.

- при миграции в облако кажется избыточным иметь колд-реплики, также как и второй сервер для бэкапов. То есть мы приводим инфраструктуроу к виду  два контейнера или ВМ с приложением, сервер для создания/хранения БД (не знаю, возможно CSP предоставляют качественную услугу бэкапа - тогда этот сервис в облаке не нужен), два контейнера или ВМ с СУБД - реплику лучше иметь на случай программных сбоев с мастером.

>Тестовые и демо сервера для нового поколения ПО:
>
>- Kubernetes кластер - 3 ноды 
>
>

- k8s требует для работы минимум одну master и одну worker ноды. Количество физических машин при миграции на ВМ опять же разумно брать две или более для отказоустойчиваости.  
Так как Kubernetes может работать с несколькими master-нодами, то миграцию опять можно провести без простоя: поднимаем на новом сервере мастер и один или несколько воркеров и подключаем их в кластер, что позволяет погасить старую инфраструктуру.

- при переезде в облако стоит делать две master-ноды для возможности их поочерёдного обслуживания и три worker-ноды.


>Инфраструктура разработки:
>
>- Jenkins сервер и 10 агентов
>- Gitlab community 
>- Jira plus Confluence 
>- Sonatype nexus 
>

- Все указанные продукты, кажется, поддерживают active-active кластеризацию, что можно использовать для обеспечения отказоустойчивости при максимальном использовании выделенных ресурсов. То есть предлагаю на два физических сервера в виртуальные машины расположить по одной ноде каждого сервиса; агенты Jenkins-а соответственно также поделить поровну.

- миграция в облако в целом выглядит также: две ноды у каждого сервиса позволят проводить обслуживание без простоя.


>Инфраструктура для вспомогательных систем:
>
>- Сервер 1С
>- Сервер SAP 
>- Сервер баз данных MS SQL для 1С
>- Сервер Jasper reports 

- миграция этих сервисов в ВМ представляется тривиальной: ставим на ВМ необходимую операционную систему, устанавливаем и конфигурируем желаемый продукт.

- миграция в облако этих систем, как я понимаю, не желательна из-за их "тяжеловесности". если это всё же необходимо, то опять же - действуем по сценарию с ВМ.
