# Домашнее задание к занятию "5.2. Системы управления виртуализацией"

## Модуль 5. Виртуализация

### Студент: Иван Жиляев

## Обязательные задания

## Задача 1 

>Выберете подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.
>
>Сценарии:
>
>- 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований  
>Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий 

Для этого сценария, пожалуй, лучше всего подойдёт Hyper-V. Программные балансировщики могут быть установлены, скажем, на ВМ с Linux и будут замечательно управлять трафиком. Репликация данных возможна через механизм Hyper-V Replica: любую ВМ со всеми данными легко можно включить в реплиуацию. Резервные копии можно делать как с помощью встроенного в ОС мастера (ВМ выделены в отдельную группу источников данных), так и с помощью отдельных систем, таких как Microsoft SystemCenter Data Protection Manager и Veeab Backup&Replication. 

>- Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин

Заявленным требованиям больше всех соответствует гипервизор KVM. Как вариант, возможно использовать продукт ProxMox, который предлагает коробочное решение виртуализации на основе KVM с дополнительными возможностями.

>- Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры

Пожалуй, выбор снова падёт на KVM - он имеет хорошую производительность, совместимость с железом и широкое сообщество для помощи в troubleshooting-е.

>- Необходимо рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux

В этом случае я бы попробовал использовать Vagrant, так как он нативно поддерживает философию IaC и мы можем подготовить несколько рабочих окружений, например, используя цикл в Vagrantfile.

## Задача 2 

>Опишите сценарий миграции с VMware vSphere на Hyper-V для Linux и Windows виртуальных машин. Детально опишите необходимые шаги для использования всех преимуществ Hyper-V для Windows.

Я хотел бы расписать два сценария.

1. Если исходная ВМ должна быть перенесена в "первозданном" виде, то я бы предпочёл использовать какой-либо готовый инструмент для "bare-metal" резервного копирования системы и последующего её восстановления на новом гипервизоре. Как вариант, пусть это будет продукт от Veeam.

   - оцениваем достаточность аппаратных ресурсов для ВМ на целевом сервере

   - оцениваем максимальное время на выполнение процедуры, которое будет складываться из:
      - времени перевода исходной ВМ в оффлайн-режим (для исключения изменения рабочих данных)
      - продолжительности выполнения резервного копирования и создания загрузочного образа для восстановления
      - продолжительности восстановления ВМ из бэкапа на целевом сервере
      - времени на донастройку ВМ (сеть, накопители и т.п.)
      - проверка корректного дуступа к ресурсам на перенесённой ВМ

   - согласовываем дату и время выполнения работ с заинтересованными лицами исходя из проведённой оценки и небольшого запаса "на форс-мажор"

   - в "час икс" оганичиваем доступ до ВМ и запускаем полное резервное копирование в расположение, доступное и с целевого сервера

   - по окончанию бэкапа на целевом сервере создаём новую ВМ, устанавливаем желаемые параметры её работы и в качестве загрузочного выбираем образ для восстановления из бэкапа; запускаем процесс

   - по окончанию восстановления запускаем ВМ и делаем необходимые настройки для доступа к сервисам на ней, например обновляем DNS-записи сервисов, или указываем на DHCP привязку старого ip-адреса к новому MAC виртуалки

   - проверка всех сервисов: обращение "снаружи", просмотр журналов доступа и т.п.

   - уведомление об окончании работ, фиксирование изменений инфраструктуры в "базе знаний", освобождение ресурсов исходного сервера от оригинальной ВМ

1. Когда нам необходимо выполнить перенос не всего содержимого ВМ, а определённых сервисов, которые поддерживают кластеризацию:

   - составляем список что необходимо перенести

   - на целевом сервере поднимаем ВМ с необходимой ОС

   - производим установку экземпляров необходимых сервисов из составленного списка

   - поднимаем кластер желаемого сервиса из исходной и новой ВМ, это подразумевает, что доступ к сервису не будет прерван, а данные будут мигрированы на новую ВМ

   - разваливаем кластер, оставляя ноду на новой ВМ

   - проверяем, что доступ до сервиса может быть реализован в полном объёме

   - выключаем/удаляем исходную ВМ, правим документацию по инфраструктуре

## Задача 3 

>Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был бы выбор, то создавали ли вы бы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

Герерогенная среда виртуализации влечёт следующие недостатки:

- затруднённость/невозможность переноса ВМ между нодами

- необходимость тратить больше времени на планирование работ, которые затрагивают все используемые виды систем управления виртуализацией

- необходимость иметь больше инженеров для разделения знаний/навыков/рабочего времени 

Решение о создании геретогенной среды должно быть оправдано, конечно желательно избегать этого. Если, например, мы решили работать на Hyper-V, то мотивацией к тому, чтобы использовать только его будет в числе прочего поддержка вложенной виртуацизации (можно постваить гипервизор на ВМ), возможности живой миграции ВМ, репликации ВМ.  
